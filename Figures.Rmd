---
title: "Figures"
author: "Richard Honor"
date: "06/05/2020"
output: html_document
---


```{r}
source("GGPlot_Themes.R")

#read in data
rm(list=ls())
dat<-read.csv("DataSynthesis.csv")

#Remove maple controls data from the data set.
dat<-dat %>% filter(treatment!="mcnt") %>% droplevels()

#Assign family column
prefamily<-gsub("*.\\|","",dat$Tag)
dat$Family<-gsub("\\-.*","",prefamily)

#remove those with fertilizer treatment, and extra genotypes that are only in the alone treatment. 
dat<-dat[!grepl("i",dat$Sample,fixed=T),]

#Initializing columns to avoid constant error messages. 
dat$WhiteFungLogis<-NA
dat$BlackFungLogis<-NA


#Function to weigh pathogen damage by leaf area. 
Weigh<-function(x){
  x/(dat$GM_Leaf_Len*dat$GM_Leaf_Wid)
}
#Function to standardize variables. 
Standardize<-function(x){
  standard<-(x-mean(x,na.rm=T))/sd(x,na.rm=T)
}

#Weighing pathogen damage
dat$BlackPathDamW<-Weigh(dat$BlackPathDam)
dat$ThripsDamW<-Weigh(dat$ThripsDam)

#Standardizing pathogen damage (not white pathogen damage, that is logistic)
dat$ThripsDamW<-Standardize(dat$ThripsDamW)
dat$BlackPathDamW<-Standardize(dat$BlackPathDamW)


#Standardizing pathogen damage (not white pathogen damage, that is logistic)
#dat$ThripsDamW<-Standardize(dat$ThripsDamW)
#dat$BlackPathDamW<-Standardize(dat$BlackPathDamW)

#Summarizing: Taking the mean value of leaves. This tibble contains data at the level of the plant means. 
dat2<-dat %>% group_by(Tag) %>% summarize(ChlorA=mean(ChlorA),ChlorB=mean(ChlorB),gluc_Conc=mean(gluc_Conc),flav_Conc=mean(flav_Conc),Family=first(Family),treatment=first(treatment),gh_row=first(gh_row),gh_bench=first(gh_bench),GM_TotalLeaf_Area=first(GM_TotalLeaf_Area),comp_number=first(comp_number),ThripsDam=mean(ThripsDam),WhiteFungDam=mean(WhiteFungDam),BlackPathDam=mean(BlackPathDam),Fern=mean(Fern),gh_col=first(gh_col),BlackPathDamW=mean(BlackPathDamW),ThripsDamW=mean(ThripsDamW))
dat

#All of these genotypes died (15 Genotypes).(We are simply missing a final measurement for e|JBCHY1-1-50|Q|240) That is only 3% Mortality. 
dead<-dat2[is.na(dat2$GM_TotalLeaf_Area),]

#Removing those with dead competitors from the garlic mustard treatment. ("e|JBCHY1-1-50|Q|240") did not die, we are simply missing the final measurement for it.

dead_competitors<-dead %>% filter(treatment=="gm",Tag!="e|JBCHY1-1-50|Q|240") %>% select(comp_number)


dat<-dat %>% filter(!comp_number %in% dead_competitors$comp_number)
dat2<-dat2 %>% filter(!comp_number %in% dead_competitors$comp_number)


```

#Black path pred for alone treatment: 
int: 9571.463
slope: -1006.665

#BlackPath pred for maple treatment: 
int: 8314.753
slope: -1607.188

#Black pred for gm treatment. 
int: 5268.98
slope: -473.91

#Visualizing
```{r}
source("GGPlot_Themes.R")
c<-ggplot(dat2)+
  geom_point(aes(y=GM_TotalLeaf_Area,x=Standardize(ThripsDamW)),colour="black")+theme_simple()+xlab("Thrips Damage")+ylab("Fitness")+
    theme(axis.title.x = element_text(color = "black", size = 16, face = "bold",margin=margin(3,0,3,0)))


a<-ggplot(dat2)+
  geom_point(aes(y=GM_TotalLeaf_Area,x=BlackPathDamW,colour=treatment))+theme_simple_vert()+
  geom_abline(intercept=9571.463,slope=-1006.665,size=1.5,colour="#009E73")+
    geom_abline(intercept=5268.98,slope=-473.91,size=1.5,colour="#56B4E9")+
  geom_abline(intercept=8314.753,slope=-1607.188,size=1.5,colour="#E69F00")+
    scale_colour_manual(values=c("#009E73","#56B4E9","#E69F00"),labels=c("Alone","Garlic Mustard","Maple"))+
  scale_x_continuous(expand = c(0,0.1))+
    xlab(bquote(bold("Black Pathogen Damage"~(count/mm^2))))+ylab(bquote(bold("Total Leaf Area"~(mm^2))))

tiff("Selection_Figures/BlackPathogenEffect.tiff", units="in", width=8, height=6, res=300)
a
dev.off()
tiff("Selection_Figures/ThripsEffect.tiff", units="in", width=8, height=6, res=300)
c
dev.off()
```

