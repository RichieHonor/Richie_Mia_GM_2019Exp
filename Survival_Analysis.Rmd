---
title: "Survival_Fitness_Analysis"
author: "Richard Honor"
date: "01/06/2020"
output: html_document
---
#Read in and prep data
```{r}
library(ggplot2)
library(glmmTMB)
#library(tidyr)
library(cowplot)
library(grid)
library(gridExtra)
library(dplyr)
source("GGPlot_Themes.R")

#read in data
rm(list=ls())
dat<-read.csv("DataSynthesis.csv")

#Remove maple controls data from the data set.
dat<-dat %>% filter(treatment!="mcnt") %>% droplevels()

#remove those with fertilizer treatment, and extra genotypes that are only in the alone treatment. 
dat<-dat[!grepl("i",dat$ID,fixed=T),]


#Initializing columns to avoid constant error messages. 
dat$WhiteFungLogis<-NA
dat$BlackFungLogis<-NA
```


#Generating data frames with summarized leaf data (dat2) and summarized genotype data (dat3)
```{r}
hist(dat$gluc_Conc)
hist(dat$flav_Conc)
#Both concentrations are above zero. 
min(dat$gluc_Conc,na.rm=T)
min(dat$flav_Conc,na.rm=T)


#Logging data
dat$Fern<-log(dat$Fern+1)
dat$gluc_Conc<-log(dat$gluc_Conc)
dat$flav_Conc<-log(dat$flav_Conc)
dat$ChlorA<-log(dat$ChlorA)
dat$ThripsDam<-log(dat$ThripsDam+1)
dat$BlackPathDam<-log(dat$BlackPathDam+1)



#Creating leaf area vector 
dat$GM_Leaf_Area<-dat$GM_Leaf_Len*dat$GM_Leaf_Wid


#Summarizing: Taking the mean value of leaves. This tibble contains data at the level of the plant means. 
dat2<-dat %>% group_by(Tag) %>% summarize(ChlorA=mean(ChlorA),ChlorB=mean(ChlorB),gluc_Conc=mean(gluc_Conc),flav_Conc=mean(flav_Conc),Family=first(Family),treatment=first(treatment),gh_row=first(gh_row),gh_bench=first(gh_bench),GM_TotalLeaf_Area=first(GM_TotalLeaf_Area),comp_number=first(comp_number),ThripsDam=mean(ThripsDam),WhiteFungDam=mean(WhiteFungDam),BlackPathDam=mean(BlackPathDam),Fern=mean(Fern),gh_col=first(gh_col),GM_Leaf_Area=mean(GM_Leaf_Area),Latitude=first(Latitude),Longitude=first(Longitude),Altitude=first(Altitude),
GM_StemHeight_Bolt=first(GM_StemHeight_Bolt),
GM_Leaf_Number_Bolt=first(GM_Leaf_Number_Bolt),
Larg_Leaf_Len_Bolt=first(Larg_Leaf_Len_Bolt),
Larg_Leaf_Wid_Bolt=first(Larg_Leaf_Wid_Bolt),
Row_Field=first(Row_Field),
Col_Field=first(Col_Field),
Maple_Died=first(Maple_Died),
Maple_TotalLeafArea_End=first(Maple_TotalLeafArea_End),
GM_Fecundity=first(GM_Fecundity),
MapleFinalMass=first(MapleFinalMass)
)

#All of these genotypes died (15 Genotypes).(We are simply missing a final measurement for e|JBCHY1-1-50|Q|240) That is only 3% Mortality. 
dead<-dat2[is.na(dat2$GM_TotalLeaf_Area),]

#Removing those with dead competitors from the garlic mustard treatment. ("e|JBCHY1-1-50|Q|240") did not die, we are simply missing the final measurement for it.

dead_competitors<-dead %>% filter(treatment=="gm",Tag!="e|JBCHY1-1-50|Q|240") %>% select(comp_number)

#Removing those with dead competitors from the analysis. 
dat2<-dat2 %>% filter(!comp_number %in% dead_competitors$comp_number)
dat<-dat %>% filter(!comp_number %in% dead_competitors$comp_number)


##Summarizing: Taking the mean value of plants. This tibble contains data at the level of the family means within each treatment. 
#dat3<-dat2 %>% drop_na(GM_TotalLeaf_Area) %>% group_by(Family,treatment)  %>% summarize_if(is.numeric,mean)



#Because of how zero inflated white pathogen damage is, i will use a logistic regression to model it.
dat2$WhiteFungLogis<-NA
dat2$WhiteFungLogis[dat2$WhiteFungDam==0]<-0
dat2$WhiteFungLogis[dat2$WhiteFungDam>0]<-1

#Creating Survival Data.1 = survived, 0= dead.
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt=="Dead"]<-0
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt!="Dead"]<-1


#Creating Maple Survival Data.1 = survived, 0= dead.
dat2$Maple_Died<-as.character(dat2$Maple_Died)
dat2$Maple_Survival[dat2$Maple_Died!="Y"]<-1
dat2$Maple_Survival[dat2$Maple_Died=="Y"]<-0
dat2<-dat2 %>% select(-Maple_Died)

  #Function to standardize variables. 
Standardize<-function(x){
  standard<-(x-mean(x,na.rm=T))/sd(x,na.rm=T)
}

#Standardizing leaf area. 
dat2$GM_Leaf_Area<-Standardize(dat2$GM_Leaf_Area)


#Changing bolts that regrew a stem and produced seeds to survived.(1 =survive)
dat2[which(dat2$GM_Leaf_Number_Bolt=="Dead"&!is.na(dat2$GM_Fecundity)),]$Bolt_Survival<-1


```



#PCA of GM SIZE in the second year. 
```{r}
#Removing dead individuals with zeros. 
dat2$GM_StemHeight_Bolt[which(dat2$GM_StemHeight_Bolt=="Dead")]<-0
dat2$GM_Leaf_Number_Bolt[which(dat2$GM_Leaf_Number_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Len_Bolt[which(dat2$Larg_Leaf_Len_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Wid_Bolt[which(dat2$Larg_Leaf_Wid_Bolt=="Dead")]<-0

#Making data numeric
dat2$GM_StemHeight_Bolt<-as.numeric(dat2$GM_StemHeight_Bolt)
dat2$GM_Leaf_Number_Bolt<-as.numeric(dat2$GM_Leaf_Number_Bolt)
dat2$Larg_Leaf_Len_Bolt<-as.numeric(dat2$Larg_Leaf_Len_Bolt)
dat2$Larg_Leaf_Wid_Bolt<-as.numeric(dat2$Larg_Leaf_Wid_Bolt)


pca<-prcomp(~GM_StemHeight_Bolt+GM_Leaf_Number_Bolt+Larg_Leaf_Len_Bolt+Larg_Leaf_Wid_Bolt,data=dat2,scale.=T,na.action=na.omit)

prediction<-as.data.frame(predict(pca))

df<-tibble::rownames_to_column(prediction, "rownumber")

dat2[df$rownumber,"PC1BoltSize"]<-df$PC1

hist(dat2$PC1BoltSize) #The data is very zero inflated because of the mortality. This isnt great but what can you do. 
```



#Generating pc1 pc2 values for glucosinolate and flavonoid and chlorophyll traits. 
```{r}
#Glucosinolate
pcaGlucCor<-prcomp(~Standardize(gluc_Conc)+Standardize(ChlorA),data=dat2,na.action=na.omit)

prediction<-as.data.frame(predict(pcaGlucCor))

df<-tibble::rownames_to_column(prediction, "rownumber")

dat2[df$rownumber,"PC1GC"]<-df$PC1
dat2[df$rownumber,"PC2GC"]<-df$PC2

#Flavonoid
pcaCorFlav<-prcomp(~Standardize(ChlorA)+Standardize(flav_Conc),data=dat2,na.action=na.omit)

prediction2<-as.data.frame(predict(pcaCorFlav))

df2<-tibble::rownames_to_column(prediction2, "rownumber")
dat2[df2$rownumber,"PC1FC"]<-df2$PC1
dat2[df2$rownumber,"PC2FC"]<-df2$PC2

```



#Descriptive Statistics
```{r}
dat2[is.na(dat2$Bolt_Survival),] #There are 10 missing genotypes from the field. Purhaps a block was missed. Right now i will leave as NA. 

#Garlic mustard survival
sum(dat2$Bolt_Survival,na.rm = T)/length(dat2$Bolt_Survival[!is.na(dat2$Bolt_Survival)])

#There was 31.2% Survival into the field for garlic mustard plants. 

# maple survival
(sum(dat2$Maple_Survival,na.rm = T)+31)/(length((dat2$Maple_Survival[!is.na(dat2$Maple_Survival)]))+31)
#There was 98.9% survival of maples. 

```



Add in fern and flav conc. 

#Survival analysis
```{r}
#Maximum model ... is interaction significant?
fit<-glmmTMB(Bolt_Survival~treatment*gluc_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")

fit2<-glmmTMB(Bolt_Survival~treatment+gluc_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit,fit2) #No interaction. ... but on the edge of significance. 

#IS gluc conc significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit3,fit2) #No 



#Is there a flav conc interaction with treatment? 
fit3<-glmmTMB(Bolt_Survival~treatment*flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit3,fit4) #No 


#IS flav conc significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit3,fit4) #No 


#IS Black PAth Dam significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
anova(fit3,fit4) #No 

#IS White PAth Dam significant? 
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")



fit5<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+ThripsDam+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")

anova(fit4,fit5) #No 

#IS thrips dam Significant?
fit5<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+ThripsDam+(1|Family),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
fit6<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+(1|Family),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
anova(fit5,fit6) #No


#Is treatment significant? 
fit7<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+(1|Family),data=dat2,family="binomial")
fit8<-glmmTMB(Bolt_Survival~Standardize(Fern)+(1|Family),data=dat2,family="binomial")
summary(fit7)
anova(fit7,fit8) #No. kind of close.  

#Is Fern significant? 
fit7<-glmmTMB(Bolt_Survival~Standardize(Fern)+(1|Family),data=dat2,family="binomial")
fit8<-glmmTMB(Bolt_Survival~1+(1|Family),data=dat2,family="binomial")
anova(fit7,fit8) #Yes. Fern is a highly significant predictor of bolt survival.  really predicts survival except for family. 
summary(fit7) #This says that ferns makes it more likely to survive... Likely an artefact of there being much less ferns in the GM treatment and so many dying there? I need to redo this analysis with pots averaged in the GM treatment. 


```


```{r}
SimpTest<-function(formula,...,Data,Variable){
 
 naVector<- !is.na(Data[[Variable]])
 
  fit1<-glmmTMB(formula,...,data=Data[naVector,])
  
  fit2<-update(fit1, ~.- unquote(Variable) )
  out<-anova(fit1,fit2)
  return(out)
}

SimpTest(Bolt_Survival~treatment+ChlorA+Standardize(GM_TotalLeaf_Area)+flav_Conc+Standardize(gluc_Conc)+(1|Family),family="binomial", Data = dat2, Variable="ChlorA")

deparse(substitute("ChlorA"))

update(fit1,~.-"ChlorA")


dat2[,rep(T,42)]
```

#Correlation with survival and fecundity. 
```{R}
#Correlates with survival. 
#######
fit<-glmmTMB(Bolt_Survival~treatment+ChlorA+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2,family="binomial")

#Is flav_Conc significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit,fit1) #No
summary(fit)

#Is gluc_Conc significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit,fit1) #No
summary(fit)

#Is ChlorA significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
anova(fit,fit1) #yes, very
summary(fit)

#Is treatment significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
anova(fit,fit1) #No

#Is Size? 
fit<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
anova(fit,fit1) #Yes, it is. 
summary(fit)

#IS there an interaction between size and treatment?
#Is Size? 
fit<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)*treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
anova(fit,fit1) #no there is not

####
#Correlates with Fecundity 
#######

#Is flav_Conc significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),])
anova(fit,fit1) #Yes.... and I also know that the interaction is significant.
summary(fit)

#Is gluc_Conc significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No
summary(fit)

#Is ChlorA significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
anova(fit,fit1) #No.... this is weird.
summary(fit)

#Is treatment significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
anova(fit,fit1) #yes

#Is Size in first year? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),])
anova(fit,fit1) #No, it is not.
summary(fit)

#Is Size in second year? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(PC1BoltSize)+(1|Family),data=dat2[!is.na(dat2$PC1BoltSize),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+(1|Family),data=dat2[!is.na(dat2$PC1BoltSize),])
anova(fit,fit1) #Yes, very much so
summary(fit)

######
#Determining if PC1 or PC2 for glucosinolate and flaovnoid determine survivial or fecundity. 
#Is gluc_Conc significant? 

#Does PC1GC influence survival?
fit<-glmmTMB(Bolt_Survival~PC1GC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1GC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1GC),],family="binomial")
anova(fit,fit1) #Yes it does. 

#Does PC2GC influence survival?
fit<-glmmTMB(Bolt_Survival~PC2GC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2GC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2GC),],family="binomial")
anova(fit,fit1) #No it does not. 


#Does PC1FC influence survival?
fit<-glmmTMB(Bolt_Survival~PC1FC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1FC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1FC),],family="binomial")
anova(fit,fit1) #Yes it does. 

#Does PC2FC?
fit<-glmmTMB(Bolt_Survival~PC2FC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2FC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2FC),],family="binomial")
anova(fit,fit1) #Yes it does. 



fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No


#####
dat2$PC1BoltSize

```

#Fern effect on survival with psedoreplication removed. 
```{r}
datFern<-dat2
datFern$Tag<-as.character(datFern$Tag)
for(i in 1:length(datFern$Tag)){
  if(!is.na(datFern$comp_number[i])){
    datFern$Tag[i]<-datFern$comp_number[i]
  }
}

#Averaging pot values in the GM treatment.
datFernGM<-datFern %>% group_by(Tag) %>% filter(treatment=="gm") %>% summarize_all(~mean(.))
datFernGM$treatment<-"gm"

#Binding collumns back together. Family should not be used as those in the GM treatment represent the average of two families. 
datFern2<-rbind(datFernGM,datFern[datFern$treatment!="gm",])

datFern2$Bolt_Survival<-as.integer(datFern2$Bolt_Survival)

#What is the effect of ferns?
fit_full1<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern),data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~treatment,data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #Fern highly significant

#Is treatment significant? 
fit_full1<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern),data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #No. What about if i remove Fern?

#Is treatment significant? 
fit_full1<-glmmTMB(Bolt_Survival~treatment,data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~1,data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #Treatment is less significant if i remove fern from the analysis. Interestingly, fern is a very big predictor of survival. 


fit_full2<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datFern2,family="binomial")


#Effect of fern on fecundity

#What is the effect of ferns?
fit_full1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(Fern),data=datFern2)

fit_full2<-glmmTMB(Standardize(GM_Fecundity)~treatment,data=datFern2)
anova(fit_full1,fit_full2) 
summary(fit_full1)
#Fern not significant here. 
```





#Survival in maple treatment only.. Is there an effect of maples on survival? 
```{r}
datM<-dat2 %>% filter(treatment=="m")
datM$Maple_Survival<-as.factor(datM$Maple_Survival)

#IS there an effect of Family
fit<-glmmTMB(Bolt_Survival~ChlorA+Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM[!is.na(datM$ChlorA),],family="binomial")
fit01<-glmmTMB(Bolt_Survival~ChlorA+Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival+(1|Family),data=datM[!is.na(datM$ChlorA),],family="binomial")
anova(fit,fit01) #FAmily not important here. 
summary(fit) 

#Is there an effect of ChlorA?
fit2<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM[!is.na(datM$ChlorA),],family="binomial")
anova(fit,fit2)#no

#Is there an effect of Maple Survival?
fit2<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM,family="binomial")
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Standardize(GM_TotalLeaf_Area),data=datM,family="binomial")
anova(fit2,fit3)# No maple survival isnt significant but hardly any died. 

#Is there an effect of GM size?
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$GM_TotalLeaf_Area),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern),data=datM[!is.na(datM$GM_TotalLeaf_Area),],family="binomial")
anova(fit3,fit4) # GM size in first year is on the verge of significance. 0.05843. 

#IS there an effect of maple size? 
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
anova(fit3,fit4) #Yes, initial maple size is increadibly important to survival. 
summary(fit3)


#IS there an effect of maple size w/o fern? 
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~1,data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
anova(fit3,fit4) #Yes, initial maple size is increadibly important to survival. 


#IS there an effect of Fern 
fit3<-glmmTMB(Bolt_Survival~Standardize(Fern)+Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$Fern),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$Fern),],family="binomial")
anova(fit3,fit4) #on the verge of significance
summary(fit3) #On the verge of significance. 




```

#Effect on fecundity. 
```{r}
#Model selection

#Is there a gluc_Conc*Treatment interaction ?
fit<-glmmTMB(GM_Fecundity~treatment*gluc_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])

fit1<-glmmTMB(GM_Fecundity~treatment+gluc_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No interaction

#Is gluc conc significant?
fit2<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit1,fit2) #No


#Is there a flav_Conc*Treatment interaction ?
fit<-glmmTMB(GM_Fecundity~treatment*flav_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$flav_Conc),])

fit1<-glmmTMB(GM_Fecundity~treatment+flav_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$flav_Conc),])
anova(fit,fit1) #Yes there is an interaction
summary(fit)

summary(fit)
#Is there a ChlorA *treatment interaction ?
fit1<-glmmTMB(GM_Fecundity~treatment*ChlorA+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ChlorA),])
fit2<-glmmTMB(GM_Fecundity~treatment+ChlorA+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ChlorA),])
anova(fit1,fit2) #Yes there is 


#Thrips  dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ThripsDam),])
fit4<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ThripsDam),])
anova(fit3,fit4) #No

#White Path dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$WhiteFungLogis),])
fit4<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$WhiteFungLogis),])
anova(fit3,fit4) #No

#Black Path dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$BlackPathDam),])
fit4<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit3,fit4) #No


#Treatment?
fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2)
fit4<-glmmTMB(GM_Fecundity~Standardize(GM_TotalLeaf_Area),data=dat2)
anova(fit3,fit4) #Yes, very much so. 

#Size in first year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2)
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2)
anova(fit3,fit4) #No size is not at all a significant predictor. 


#Size in second year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(PC1BoltSize),data=dat2[!is.na(dat2$PC1BoltSize),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$PC1BoltSize),])
anova(fit3,fit4) #Yes Size in the second year predicts performance, but not in the first year. 

#flav_Conc? in second year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(flav_Conc),data=dat2[!is.na(dat2$flav_Conc),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$flav_Conc),])
anova(fit3,fit4) #Yes flav_Conc is significant... positively associated with it. ... just like chlorophyll

#CHlorA
fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(ChlorA),data=dat2[!is.na(dat2$ChlorA),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$ChlorA),])
anova(fit3,fit4) #ChlorA is not significant though... weird. 
summary(fit3)


#Treatment (Again)?
fit3<-glmmTMB(Standardize(GM_Fecundity)~treatment,data=dat2)
fit4<-glmmTMB(Standardize(GM_Fecundity)~1,data=dat2)
anova(fit3,fit4) #Yes, very much so.

#Interaction (Again)?
fit3<-glmmTMB(Standardize(GM_Fecundity)~treatment*flav_Conc,data=dat2)
fit4<-glmmTMB(Standardize(GM_Fecundity)~treatment+flav_Conc,data=dat2)
anova(fit3,fit4) #Yes, very much so.
summary(fit3)

#Could just leave it because could detect no flavonoids in the roots. ...



```

#Fecundity in the maple treatment.

```{r}

fit<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family),data=datM[!is.na(datM$ChlorA),])
fit01<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family)+(1|gh_bench),data=datM[!is.na(datM$ChlorA),])
anova(fit,fit01)#gh bench not importnat
fit02<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family)+(1|Col_Field),data=datM[!is.na(datM$ChlorA),])
anova(fit,fit02) #Field location not important
fit03<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival,data=datM[!is.na(datM$ChlorA),])
anova(fit,fit03) #Family  not important


#Is there an effect of Survival?
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass)+as.factor(Maple_Survival),data=datM[!is.na(datM$Maple_Survival),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_Survival),])
anova(fit2,fit3) #No, Maple Survival is not important. 


#Is there an effect of GM Size in first year?
fit2<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass),data=datM[!is.na(datM$GM_TotalLeaf_Area),])
fit3<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass),data=datM[!is.na(datM$GM_TotalLeaf_Area),])
anova(fit2,fit3) #No, Size in the first year is not important. 

#Is there an effect of maple size in the first year? 
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_TotalLeafArea_End),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_TotalLeafArea_End),])
summary(fit2)
anova(fit2,fit3) #No. 

#IS there an effect of maple size in the second year? 
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(MapleFinalMass),data=datM[!is.na(datM$MapleFinalMass),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~1,data=datM[!is.na(datM$MapleFinalMass),])
summary(fit2)
anova(fit2,fit3) #No there is not 


```

#Survival and fecundity in the gm treatment is found in the "Performance_Intraspecific" file. 









