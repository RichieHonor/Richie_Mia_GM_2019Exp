---
title: "Survival_Fitness_Analysis"
author: "Richard Honor"
date: "01/06/2020"
output: html_document
---
#Read in and prep data
```{r}
library(ggplot2)
library(glmmTMB)
#library(tidyr)
library(cowplot)
library(grid)
library(gridExtra)
library(dplyr)
source("GGPlot_Themes.R")

#read in data
rm(list=ls())
dat<-read.csv("DataSynthesis.csv")

#Remove maple controls data from the data set.
dat<-dat %>% filter(treatment!="mcnt") %>% droplevels()

#remove those with fertilizer treatment, and extra genotypes that are only in the alone treatment. 
dat<-dat[!grepl("i",dat$ID,fixed=T),]


#Initializing columns to avoid constant error messages. 
dat$WhiteFungLogis<-NA
dat$BlackFungLogis<-NA
```


#Generating data frames with summarized leaf data (dat2) and summarized genotype data (dat3)
```{r}
hist(dat$gluc_Conc)
hist(dat$flav_Conc)
#Both concentrations are above zero. 
min(dat$gluc_Conc,na.rm=T)
min(dat$flav_Conc,na.rm=T)


#Logging data
dat$Fern<-log(dat$Fern+1)
dat$gluc_Conc<-log(dat$gluc_Conc)
dat$flav_Conc<-log(dat$flav_Conc)
dat$ChlorA<-log(dat$ChlorA)
dat$ThripsDam<-log(dat$ThripsDam+1)
dat$BlackPathDam<-log(dat$BlackPathDam+1)



#Creating leaf area vector 
dat$GM_Leaf_Area<-dat$GM_Leaf_Len*dat$GM_Leaf_Wid


#Summarizing: Taking the mean value of leaves. This tibble contains data at the level of the plant means. 
dat2<-dat %>% group_by(Tag) %>% summarize(ChlorA=mean(ChlorA),ChlorB=mean(ChlorB),gluc_Conc=mean(gluc_Conc),flav_Conc=mean(flav_Conc),Family=first(Family),treatment=first(treatment),gh_row=first(gh_row),gh_bench=first(gh_bench),GM_TotalLeaf_Area=first(GM_TotalLeaf_Area),comp_number=first(comp_number),ThripsDam=mean(ThripsDam),WhiteFungDam=mean(WhiteFungDam),BlackPathDam=mean(BlackPathDam),Fern=mean(Fern),gh_col=first(gh_col),GM_Leaf_Area=mean(GM_Leaf_Area),Latitude=first(Latitude),Longitude=first(Longitude),Altitude=first(Altitude),
GM_StemHeight_Bolt=first(GM_StemHeight_Bolt),
GM_Leaf_Number_Bolt=first(GM_Leaf_Number_Bolt),
Larg_Leaf_Len_Bolt=first(Larg_Leaf_Len_Bolt),
Larg_Leaf_Wid_Bolt=first(Larg_Leaf_Wid_Bolt),
Row_Field=first(Row_Field),
Col_Field=first(Col_Field),
Maple_Died=first(Maple_Died),
Maple_TotalLeafArea_End=first(Maple_TotalLeafArea_End),
GM_Fecundity=first(GM_Fecundity),
MapleFinalMass=first(MapleFinalMass)
)

#All of these genotypes died (15 Genotypes).(We are simply missing a final measurement for e|JBCHY1-1-50|Q|240) That is only 3% Mortality. 
dead<-dat2[is.na(dat2$GM_TotalLeaf_Area),]

#Removing those with dead competitors from the garlic mustard treatment. ("e|JBCHY1-1-50|Q|240") did not die, we are simply missing the final measurement for it.

dead_competitors<-dead %>% filter(treatment=="gm",Tag!="e|JBCHY1-1-50|Q|240") %>% select(comp_number)

#Removing those with dead competitors from the analysis. 
dat2<-dat2 %>% filter(!comp_number %in% dead_competitors$comp_number)
dat<-dat %>% filter(!comp_number %in% dead_competitors$comp_number)


##Summarizing: Taking the mean value of plants. This tibble contains data at the level of the family means within each treatment. 
#dat3<-dat2 %>% drop_na(GM_TotalLeaf_Area) %>% group_by(Family,treatment)  %>% summarize_if(is.numeric,mean)



#Because of how zero inflated white pathogen damage is, i will use a logistic regression to model it.
dat2$WhiteFungLogis<-NA
dat2$WhiteFungLogis[dat2$WhiteFungDam==0]<-0
dat2$WhiteFungLogis[dat2$WhiteFungDam>0]<-1

#Creating Survival Data.1 = survived, 0= dead.
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt=="Dead"]<-0
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt!="Dead"]<-1


#Creating Maple Survival Data.1 = survived, 0= dead.
dat2$Maple_Died<-as.character(dat2$Maple_Died)
dat2$Maple_Survival[dat2$Maple_Died!="Y"]<-1
dat2$Maple_Survival[dat2$Maple_Died=="Y"]<-0
dat2<-dat2 %>% select(-Maple_Died)

  #Function to standardize variables. 
Standardize<-function(x){
  standard<-(x-mean(x,na.rm=T))/sd(x,na.rm=T)
}

#Standardizing leaf area. 
dat2$GM_Leaf_Area<-Standardize(dat2$GM_Leaf_Area)


#Changing bolts that regrew a stem and produced seeds to survived.(1 =survive)
dat2[which(dat2$GM_Leaf_Number_Bolt=="Dead"&!is.na(dat2$GM_Fecundity)),]$Bolt_Survival<-1


```



#PCA of GM SIZE in the second year. 
```{r}
#Removing dead individuals with zeros. 
dat2$GM_StemHeight_Bolt[which(dat2$GM_StemHeight_Bolt=="Dead")]<-0
dat2$GM_Leaf_Number_Bolt[which(dat2$GM_Leaf_Number_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Len_Bolt[which(dat2$Larg_Leaf_Len_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Wid_Bolt[which(dat2$Larg_Leaf_Wid_Bolt=="Dead")]<-0

#Making data numeric
dat2$GM_StemHeight_Bolt<-as.numeric(dat2$GM_StemHeight_Bolt)
dat2$GM_Leaf_Number_Bolt<-as.numeric(dat2$GM_Leaf_Number_Bolt)
dat2$Larg_Leaf_Len_Bolt<-as.numeric(dat2$Larg_Leaf_Len_Bolt)
dat2$Larg_Leaf_Wid_Bolt<-as.numeric(dat2$Larg_Leaf_Wid_Bolt)


pca<-prcomp(~GM_StemHeight_Bolt+GM_Leaf_Number_Bolt+Larg_Leaf_Len_Bolt+Larg_Leaf_Wid_Bolt,data=dat2,scale.=T,na.action=na.omit)

prediction<-as.data.frame(predict(pca))

df<-tibble::rownames_to_column(prediction, "rownumber")

dat2[df$rownumber,"PC1BoltSize"]<-df$PC1

hist(dat2$PC1BoltSize) #The data is very zero inflated because of the mortality. This isnt great but what can you do. 
```



#Generating PCA for Glucosinolate, Flavonoid and Chlorophyll
```{r}
#######
#Trying a pca with all three variables.
#########
pcaGlucCorFlav<-prcomp(~Standardize(gluc_Conc)+Standardize(ChlorA)+Standardize(flav_Conc),data=dat2,na.action=na.omit)
biplot(pcaGlucCorFlav)
pcaGlucCorFlav
summary(pcaGlucCorFlav)
pcaGlucCorFlav
#Loading to data frame.
prediction<-as.data.frame(predict(pcaGlucCorFlav))


df2<-tibble::rownames_to_column(prediction, "rownumber")
dat2[df2$rownumber,"PC1AllCGF"]<-df2$PC1
dat2[df2$rownumber,"PC2All_CF"]<-df2$PC2
dat2[df2$rownumber,"PC3All_CG"]<-df2$PC3

#PC2 is off diagonal for flav. (Higher values is higher flavonoid:Chlorophyll)
#PC3 is the off diagonal for glucosinolate.  (Higher values is higher glucosinolate:Chlorophyll)



```



#Descriptive Statistics
```{r}
dat2[is.na(dat2$Bolt_Survival),] #There are 10 missing genotypes from the field. Purhaps a block was missed. Right now i will leave as NA. 

#Garlic mustard survival
sum(dat2$Bolt_Survival,na.rm = T)/length(dat2$Bolt_Survival[!is.na(dat2$Bolt_Survival)])

#There was 31.2% Survival into the field for garlic mustard plants. 

# maple survival
(sum(dat2$Maple_Survival,na.rm = T)+31)/(length((dat2$Maple_Survival[!is.na(dat2$Maple_Survival)]))+31)
#There was 98.9% survival of maples. 

```



Add in fern and flav conc. 

#Survival analysis Updated to include PCA values. 
```{r}
#Maximum model ... is interaction significant?
fit<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|Col_Field),data=dat2,family="binomial")

fit2<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|Row_Field),data=dat2,family="binomial")

fit3<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|gh_bench),data=dat2,family="binomial")

fit4<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family),data=dat2,family="binomial")

fit5<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Row_Field),data=dat2,family="binomial")

#IS column in field significant?
anova(fit,fit4) # No

#IS row in field significant?
anova(fit2,fit4) #Yes it is. 

#IS gh_bench  significant?
anova(fit3,fit4) #No.

#IS family  significant?
anova(fit5,fit2) #Yes

###Modelling fixed effects 

fit1<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|Row_Field),data=dat2,family="binomial")


fit2<-update(fit1,~.-ThripsDam:BlackPathDam:WhiteFungLogis)
anova(fit1,fit2) #Not a significant three way interaction.

fit3<-update(fit2,~.-BlackPathDam:WhiteFungLogis)
anova(fit3,fit2) #There is not a significant two way interaction, 

fit4<-update(fit3,~.-BlackPathDam:ThripsDam)
anova(fit4,fit3)
#There is not a significant interaction between black path dam and thrips dam. 

fit5<-update(fit4,~.-WhiteFungLogis:ThripsDam)
anova(fit5,fit4) #There is not a significant whitefung dam and thrips dam interaction. 

#IS the interaction between treatment and PC3All_CG significant?
fit6<-update(fit5,~.-treatment:PC3All_CG)
anova(fit6,fit5) #No. 

#IS the interaction between treatment and PC2All_CF significant?
fit7<-update(fit6,~.-treatment:PC2All_CF)
anova(fit7,fit6) #Yes it is but this is also on the edge 0.044 and will be checked again later. 

#IS PC3All_CG significant? 
fit8<-update(fit7,~.-PC3All_CG)
anova(fit8,fit7) #p=0.06... right on the edge will double check later. 


#IS the interaction between treatment and PC1AllCGF significant?
fit9<-update(fit7,~.-treatment:PC1AllCGF)
anova(fit9,fit7) #Yes, this interaction is also significant. p=0.044. Will double check after removing pathogen data. 

#IS thrips dam significant?
fit10<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
fit11<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+BlackPathDam+WhiteFungLogis+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
anova(fit10,fit11) #No.


#IS Black Path dam significant?
fit10<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+BlackPathDam+WhiteFungLogis+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
fit11<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+WhiteFungLogis+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
anova(fit10,fit11) #No.

#IS White Fung dam significant?
fit10<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+WhiteFungLogis+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")
fit11<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")
anova(fit10,fit11) #No.

#IS Fern significant?
fit10<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+Standardize(Fern)+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$Fern),],family="binomial")
fit11<-glmmTMB(Bolt_Survival~treatment*PC1AllCGF+treatment*PC2All_CF+PC3All_CG+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$Fern),],family="binomial")
anova(fit10,fit11) #Yes, fern is highly significant. 


#IS the interaction between treatment and PC2All_CF significant (testing again)?
fit11<-update(fit10,~.-treatment:PC2All_CF)
anova(fit11,fit10) #Yes it is even more significant than before. 

#IS the interaction between treatment and PC1AllCGF significant (testing again)?
fit11<-update(fit10,~.-treatment:PC1AllCGF)
anova(fit11,fit10) #No this is no longer significant.

#IS  PC1AllCGF significant at all?
fit12<-update(fit11,~.-PC1AllCGF)
anova(fit12,fit11) #right on the edge... 0.051

#IS  PC3AllCG significant at all?
fit12<-update(fit11,~.-PC3All_CG)
anova(fit12,fit11) #No, now it is not significant at all. 

#IS  PC1AllCGF significant at all?
fit13<-update(fit12,~.-PC1AllCGF)
anova(fit13,fit12) #Still on the edge... 0.005006..  probably just significant. 

#IS the interaction between treatment and PC2All_CF significant (testing a third time)?
fit13<-update(fit12,~.-treatment:PC2All_CF)
anova(fit13,fit12) #Yes it is even more significant than before. p=0.01

summary(fit12) #Weird that fern is associated with increased survival. 


```

#Effect on fecundity update with treatment*PCA interactions.  
```{r}
#Model selection
#Maximum model ... is interaction significant?
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|Col_Field),data=dat2[!is.na(dat2$Col_Field|dat2$Row_Field),])

fit2<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|Row_Field),data=dat2[!is.na(dat2$Col_Field|dat2$Row_Field),])

fit3<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$Col_Field|dat2$Row_Field),])

fit4<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family),data=dat2[!is.na(dat2$Col_Field|dat2$Row_Field),])

fit5<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Row_Field),data=dat2[!is.na(dat2$Col_Field|dat2$Row_Field),])

#IS column in field significant?
anova(fit,fit4) # No

#IS row in field significant?
anova(fit2,fit4) #No

#IS gh_bench  significant?
anova(fit3,fit4) #No.

#IS family  significant?
anova(fit5,fit2) #No.. fairly close however. 0.086

###Modelling fixed effects 

fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+treatment*PC2All_CF+treatment*PC3All_CG+Standardize(Fern)+BlackPathDam*WhiteFungLogis*ThripsDam,data=dat2)


fit2<-update(fit1,~.-ThripsDam:BlackPathDam:WhiteFungLogis)
anova(fit1,fit2) #Not a significant three way interaction.

fit3<-update(fit2,~.-BlackPathDam:WhiteFungLogis)
anova(fit3,fit2) #There is not a significant two way interaction, 

fit4<-update(fit3,~.-BlackPathDam:ThripsDam)
anova(fit4,fit3)
#There is not a significant interaction between black path dam and thrips dam. 

fit5<-update(fit4,~.-WhiteFungLogis:ThripsDam)
anova(fit5,fit4) #There is not a significant whitefung dam and thrips dam interaction. 

#IS the interaction between treatment and PC3All_CG significant?
fit6<-update(fit5,~.-treatment:PC3All_CG)
anova(fit6,fit5) #No. 

#IS the interaction between treatment and PC2All_CF significant?
fit7<-update(fit6,~.-treatment:PC2All_CF)
anova(fit7,fit6) #No. 

#IS PC3All_CG significant? 
fit8<-update(fit7,~.-PC3All_CG)
anova(fit8,fit7) #No 

#IS the interaction between treatment and PC1AllCGF significant?
fit9<-update(fit8,~.-treatment:PC1AllCGF)
anova(fit9,fit8) #Yes, the interaction between PC1AllCGF and fecundity is significant. p=0.036

#IS  PC2_CFAllCG significant at all?
fit9<-update(fit8,~.-PC2All_CF)
anova(fit9,fit8) #No, not it is not significant at all. 

#IS thrips dam significant?
fit10<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam,data=dat2[!is.na(dat2$ThripsDam),])
fit11<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern)+BlackPathDam+WhiteFungLogis,data=dat2[!is.na(dat2$ThripsDam),])
anova(fit10,fit11) #No.


#IS Black Path dam significant?
fit10<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern)+BlackPathDam+WhiteFungLogis,data=dat2[!is.na(dat2$BlackPathDam),])
fit11<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern)+WhiteFungLogis,data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit10,fit11) #No.


#IS White Fung dam significant?
fit10<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern)+WhiteFungLogis,data=dat2[!is.na(dat2$WhiteFungLogis),])
fit11<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern),data=dat2[!is.na(dat2$WhiteFungLogis),])
anova(fit10,fit11) #No.


#IS Fern significant?
fit10<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF+Standardize(Fern),data=dat2[!is.na(dat2$Fern),])
fit11<-glmmTMB(Standardize(GM_Fecundity)~treatment*PC1AllCGF,data=dat2[!is.na(dat2$Fern),])
anova(fit10,fit11) #No.

#The simplest best model is

fit11<-glmmTMB(Standardize(GM_Fecundity)~treatment*Standardize(PC1AllCGF),data=dat2)
summary(fit11)

#The exact same effect was observed for fecundity, which is incredibly wierd and slighly unsettling. 
```



#Visualization -- The conditional benefit of PC1 (allelopathy)
```{r}
source("GGPlot_Themes.R")
#Is the cost dependent on the treatment? 

aloneSlope<-function(x){
  y=-0.1375 *x+ 0.4596
  return(y)
}
mapleSlope<-function(x){
  y=(-0.1375 +0.6777)*x+0.4596 -0.2420
  return(y)
}

mustardSlope<-function(x){
  y=(-0.1375 +0.1682)*x+0.4596-0.9557
  return(y)
}

#Standardizing variables.
dat2$PC1AllCGFS<-Standardize(dat2$PC1AllCGF)

minM<-min(dat2$PC1AllCGFS[dat2$treatment=="m" & !is.na(dat2$GM_Fecundity)],na.rm = T)
maxM<-max(dat2$PC1AllCGFS[dat2$treatment=="m"& !is.na(dat2$GM_Fecundity)],na.rm = T)

minA<-min(dat2$PC1AllCGFS[dat2$treatment=="a"& !is.na(dat2$GM_Fecundity)],na.rm = T)
maxA<-max(dat2$PC1AllCGFS[dat2$treatment=="a"& !is.na(dat2$GM_Fecundity)],na.rm = T)

minG<-min(dat2$PC1AllCGFS[dat2$treatment=="gm"& !is.na(dat2$GM_Fecundity)],na.rm = T)
maxG<-max(dat2$PC1AllCGFS[dat2$treatment=="gm"& !is.na(dat2$GM_Fecundity)],na.rm = T)


#tiff("Selection_Figures/LeafQualityOnFecundity.tiff", units="in", width=8, height=6, res=300)
FecTiff<-ggplot(dat2)+
  geom_point(aes(y=Standardize(GM_Fecundity),x=PC1AllCGFS,colour=treatment),size=2)+
  geom_segment(x=minA,xend=maxA,y=aloneSlope(minA),yend=aloneSlope(maxA),colour="#009E73",size=1.5)+
    geom_segment(x=minM,xend=maxM,y=mapleSlope(minM),yend=mapleSlope(maxM),colour="#E69F00",size=1.5)+
  geom_segment(x=minG,xend=maxG,y=mustardSlope(minG),yend=mustardSlope(maxG),colour="#56B4E9",size=1.5)+theme_simple_multiCol_First()+
  ylab(bquote(bold("Fecundity (σ)")))+xlab("Leaf Quality (σ)")+
  scale_y_continuous(breaks=seq(-2,5,by=0.5))+
  scale_x_continuous(breaks=seq(-5,5,by=1))+
  scale_colour_manual(values=c("#009E73","#56B4E9","#E69F00"),labels=c("Alone","Intraspecific","Interspecific"))

Leg<-ggplot(dat2)+
  geom_point(aes(y=Standardize(GM_Fecundity),x=PC1AllCGFS,colour=treatment),size=2)+
  geom_segment(x=minA,xend=maxA,y=aloneSlope(minA),yend=aloneSlope(maxA),colour="#009E73",size=1.5)+
    geom_segment(x=minM,xend=maxM,y=mapleSlope(minM),yend=mapleSlope(maxM),colour="#E69F00",size=1.5)+
  geom_segment(x=minG,xend=maxG,y=mustardSlope(minG),yend=mustardSlope(maxG),colour="#56B4E9",size=1.5)+theme_simple()+
  ylab(bquote(bold("Fecundity (σ)")))+xlab("Leaf Quality (σ)")+
  #scale_y_continuous(breaks=seq(-2,3,by=0.5))+
  #scale_x_continuous(breaks=seq(-5,5,by=1))+
  scale_colour_manual(values=c("#009E73","#56B4E9","#E69F00"),labels=c("Alone","Intraspecific","Interspecific"))

#dev.off()


FecTiff
TLATiff



d<-get_legend(Leg)

plots <- align_plots(TLATiff,FecTiff,align="hv")

top<-plot_grid(plots[[1]],plots[[2]],ncol=2,rel_widths=c(1,1),rel_heights = c(1,1),labels = c("a","b"),label_fontfamily = "Arial",label_size = 18)

tiff("Selection_Figures/PC1SelectionMulti.tiff", units="in", width=14, height=8, res=300)
plot_grid(d,top,ncol=1,rel_heights = c(1,3.5))
dev.off()

```







#Survival analysis 
```{r}
#Maximum model ... is interaction significant?
fit<-glmmTMB(Bolt_Survival~treatment*gluc_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")

fit2<-glmmTMB(Bolt_Survival~treatment+gluc_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit,fit2) #No interaction. ... but on the edge of significance. 

#IS gluc conc significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit3,fit2) #No 



#Is there a flav conc interaction with treatment? 
fit3<-glmmTMB(Bolt_Survival~treatment*flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit3,fit4) #No 


#IS flav conc significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+flav_Conc+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit3,fit4) #No 


#IS Black PAth Dam significant? 
fit3<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
anova(fit3,fit4) #No 

#IS White PAth Dam significant? 
fit4<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+WhiteFungLogis+ThripsDam+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")



fit5<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+ThripsDam+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")

anova(fit4,fit5) #No 

#IS thrips dam Significant?
fit5<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+ThripsDam+(1|Family),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
fit6<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+(1|Family),data=dat2[!is.na(dat2$ThripsDam),],family="binomial")
anova(fit5,fit6) #No


#Is treatment significant? 
fit7<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern)+(1|Family),data=dat2,family="binomial")
fit8<-glmmTMB(Bolt_Survival~Standardize(Fern)+(1|Family),data=dat2,family="binomial")
summary(fit7)
anova(fit7,fit8) #No. kind of close.  

#Is Fern significant? 
fit7<-glmmTMB(Bolt_Survival~Standardize(Fern)+(1|Family),data=dat2,family="binomial")
fit8<-glmmTMB(Bolt_Survival~1+(1|Family),data=dat2,family="binomial")
anova(fit7,fit8) #Yes. Fern is a highly significant predictor of bolt survival.  really predicts survival except for family. 
summary(fit7) #This says that ferns makes it more likely to survive... Likely an artefact of there being much less ferns in the GM treatment and so many dying there? I need to redo this analysis with pots averaged in the GM treatment. 


```


```{r}
SimpTest<-function(formula,...,Data,Variable){
 
 naVector<- !is.na(Data[[Variable]])
 
  fit1<-glmmTMB(formula,...,data=Data[naVector,])
  
  fit2<-update(fit1, ~.- unquote(Variable) )
  out<-anova(fit1,fit2)
  return(out)
}

SimpTest(Bolt_Survival~treatment+ChlorA+Standardize(GM_TotalLeaf_Area)+flav_Conc+Standardize(gluc_Conc)+(1|Family),family="binomial", Data = dat2, Variable="ChlorA")

deparse(substitute("ChlorA"))

update(fit1,~.-"ChlorA")


dat2[,rep(T,42)]
```

#Correlation with survival and fecundity. 
```{R}
#Correlates with survival. 
#######
fit<-glmmTMB(Bolt_Survival~treatment+ChlorA+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2,family="binomial")

#Is flav_Conc significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),],family="binomial")
anova(fit,fit1) #No
summary(fit)

#Is gluc_Conc significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),],family="binomial")
anova(fit,fit1) #No
summary(fit)

#Is ChlorA significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
anova(fit,fit1) #yes, very
summary(fit)

#Is treatment significant? 
fit<-glmmTMB(Bolt_Survival~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),],family="binomial")
anova(fit,fit1) #No

#Is Size? 
fit<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
anova(fit,fit1) #Yes, it is. 
summary(fit)

#IS there an interaction between size and treatment?
#Is Size? 
fit<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)*treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),],family="binomial")
anova(fit,fit1) #no there is not

####
#Correlates with Fecundity 
#######

#Is flav_Conc significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(flav_Conc)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$flav_Conc),])
anova(fit,fit1) #Yes.... and I also know that the interaction is significant.
summary(fit)

#Is gluc_Conc significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No
summary(fit)

#Is ChlorA significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
anova(fit,fit1) #No.... this is weird.
summary(fit)

#Is treatment significant? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~+Standardize(ChlorA)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$ChlorA),])
anova(fit,fit1) #yes

#Is Size in first year? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+(1|Family),data=dat2[!is.na(dat2$GM_TotalLeaf_Area),])
anova(fit,fit1) #No, it is not.
summary(fit)

#Is Size in second year? 
fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(PC1BoltSize)+(1|Family),data=dat2[!is.na(dat2$PC1BoltSize),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+(1|Family),data=dat2[!is.na(dat2$PC1BoltSize),])
anova(fit,fit1) #Yes, very much so
summary(fit)

######
#Determining if PC1 or PC2 for glucosinolate and flaovnoid determine survivial or fecundity. 
#Is gluc_Conc significant? 

#Does PC1GC influence survival?
fit<-glmmTMB(Bolt_Survival~PC1GC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1GC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1GC),],family="binomial")
anova(fit,fit1) #Yes it does. 

#Does PC2GC influence survival?
fit<-glmmTMB(Bolt_Survival~PC2GC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2GC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2GC),],family="binomial")
anova(fit,fit1) #No it does not. 


#Does PC1FC influence survival?
fit<-glmmTMB(Bolt_Survival~PC1FC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1FC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC1FC),],family="binomial")
anova(fit,fit1) #Yes it does. 

#Does PC2FC?
fit<-glmmTMB(Bolt_Survival~PC2FC+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2FC),],family="binomial")
fit1<-glmmTMB(Bolt_Survival~Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$PC2FC),],family="binomial")
anova(fit,fit1) #Yes it does. 



fit<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+Standardize(gluc_Conc)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
fit1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(ChlorA)+Standardize(flav_Conc)+Standardize(GM_TotalLeaf_Area)+(1|Family),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No


#####
dat2$PC1BoltSize

```

#Fern effect on survival with psedoreplication removed. 
```{r}
datFern<-dat2
datFern$Tag<-as.character(datFern$Tag)
for(i in 1:length(datFern$Tag)){
  if(!is.na(datFern$comp_number[i])){
    datFern$Tag[i]<-datFern$comp_number[i]
  }
}

#Averaging pot values in the GM treatment.
datFernGM<-datFern %>% group_by(Tag) %>% filter(treatment=="gm") %>% summarize_all(~mean(.))
datFernGM$treatment<-"gm"

#Binding collumns back together. Family should not be used as those in the GM treatment represent the average of two families. 
datFern2<-rbind(datFernGM,datFern[datFern$treatment!="gm",])

datFern2$Bolt_Survival<-as.integer(datFern2$Bolt_Survival)

#What is the effect of ferns?
fit_full1<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern),data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~treatment,data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #Fern highly significant

#Is treatment significant? 
fit_full1<-glmmTMB(Bolt_Survival~treatment+Standardize(Fern),data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #No. What about if i remove Fern?

#Is treatment significant? 
fit_full1<-glmmTMB(Bolt_Survival~treatment,data=datFern2,family="binomial")

fit_full2<-glmmTMB(Bolt_Survival~1,data=datFern2,family="binomial")
anova(fit_full1,fit_full2) #Treatment is less significant if i remove fern from the analysis. Interestingly, fern is a very big predictor of survival. 


fit_full2<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datFern2,family="binomial")


#Effect of fern on fecundity

#What is the effect of ferns?
fit_full1<-glmmTMB(Standardize(GM_Fecundity)~treatment+Standardize(Fern),data=datFern2)

fit_full2<-glmmTMB(Standardize(GM_Fecundity)~treatment,data=datFern2)
anova(fit_full1,fit_full2) 

#What is the effect of Treatment? 
fit_full2<-glmmTMB(Standardize(GM_Fecundity)~treatment,data=datFern2)
fit_full3<-glmmTMB(Standardize(GM_Fecundity)~1,data=datFern2)
anova(fit_full2,fit_full3)

summary(fit_full1)
summary(fit_full2)
#Fern not significant here. 
```





#Survival in maple treatment only.. Is there an effect of maples on survival? 
```{r}
datM<-dat2 %>% filter(treatment=="m")
datM$Maple_Survival<-as.factor(datM$Maple_Survival)

#IS there an effect of Family
fit<-glmmTMB(Bolt_Survival~ChlorA+Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM[!is.na(datM$ChlorA),],family="binomial")
fit01<-glmmTMB(Bolt_Survival~ChlorA+Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival+(1|Family),data=datM[!is.na(datM$ChlorA),],family="binomial")
anova(fit,fit01) #FAmily not important here. 
summary(fit) 

#Is there an effect of ChlorA?
fit2<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM[!is.na(datM$ChlorA),],family="binomial")
anova(fit,fit2)#no

#Is there an effect of Maple Survival?
fit2<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Maple_Survival,data=datM,family="binomial")
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Standardize(GM_TotalLeaf_Area),data=datM,family="binomial")
anova(fit2,fit3)# No maple survival isnt significant but hardly any died. 

#Is there an effect of GM size?
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$GM_TotalLeaf_Area),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern),data=datM[!is.na(datM$GM_TotalLeaf_Area),],family="binomial")
anova(fit3,fit4) # GM size in first year is on the verge of significance. 0.05843. 

#IS there an effect of maple size? 
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(Fern),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Fern),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
anova(fit3,fit4) #Yes, initial maple size is increadibly important to survival. 
summary(fit3)


#IS there an effect of maple size w/o fern? 
fit3<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End),data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~1,data=datM[!is.na(datM$Maple_TotalLeafArea_End),],family="binomial")
anova(fit3,fit4) #Yes, initial maple size is increadibly important to survival. 


#IS there an effect of Fern 
fit3<-glmmTMB(Bolt_Survival~Standardize(Fern)+Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$Fern),],family="binomial")
fit4<-glmmTMB(Bolt_Survival~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area),data=datM[!is.na(datM$Fern),],family="binomial")
anova(fit3,fit4) #on the verge of significance
summary(fit3) #On the verge of significance. 




```

#Effect on fecundity. 
```{r}
#Model selection

#Is there a gluc_Conc*Treatment interaction ?
fit<-glmmTMB(GM_Fecundity~treatment*gluc_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])

fit1<-glmmTMB(GM_Fecundity~treatment+gluc_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit,fit1) #No interaction

#Is gluc conc significant?
fit2<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$gluc_Conc),])
anova(fit1,fit2) #No


#Is there a flav_Conc*Treatment interaction ?
fit<-glmmTMB(GM_Fecundity~treatment*flav_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$flav_Conc),])

fit1<-glmmTMB(GM_Fecundity~treatment+flav_Conc+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$flav_Conc),])
anova(fit,fit1) #Yes there is an interaction
summary(fit)

summary(fit)
#Is there a ChlorA *treatment interaction ?
fit1<-glmmTMB(GM_Fecundity~treatment*ChlorA+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ChlorA),])
fit2<-glmmTMB(GM_Fecundity~treatment+ChlorA+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ChlorA),])
anova(fit1,fit2) #Yes there is 


#Thrips  dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+ThripsDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ThripsDam),])
fit4<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$ThripsDam),])
anova(fit3,fit4) #No

#White Path dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+WhiteFungLogis+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$WhiteFungLogis),])
fit4<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$WhiteFungLogis),])
anova(fit3,fit4) #No

#Black Path dam?
fit3<-glmmTMB(GM_Fecundity~treatment+BlackPathDam+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$BlackPathDam),])
fit4<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit3,fit4) #No


#Treatment?
fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2)
fit4<-glmmTMB(GM_Fecundity~Standardize(GM_TotalLeaf_Area),data=dat2)
anova(fit3,fit4) #Yes, very much so. 

#Size in first year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(GM_TotalLeaf_Area),data=dat2)
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2)
anova(fit3,fit4) #No size is not at all a significant predictor. 


#Size in second year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(PC1BoltSize),data=dat2[!is.na(dat2$PC1BoltSize),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$PC1BoltSize),])
anova(fit3,fit4) #Yes Size in the second year predicts performance, but not in the first year. 

#flav_Conc? in second year?

fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(flav_Conc),data=dat2[!is.na(dat2$flav_Conc),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$flav_Conc),])
anova(fit3,fit4) #Yes flav_Conc is significant... positively associated with it. ... just like chlorophyll

#CHlorA
fit3<-glmmTMB(GM_Fecundity~treatment+Standardize(ChlorA),data=dat2[!is.na(dat2$ChlorA),])
fit4<-glmmTMB(GM_Fecundity~treatment,data=dat2[!is.na(dat2$ChlorA),])
anova(fit3,fit4) #ChlorA is not significant though... weird. 
summary(fit3)


#Treatment (Again)?
fit3<-glmmTMB(Standardize(GM_Fecundity)~treatment,data=dat2)
fit4<-glmmTMB(Standardize(GM_Fecundity)~1,data=dat2)
anova(fit3,fit4) #Yes, very much so.

#Interaction (Again)?
fit3<-glmmTMB(Standardize(GM_Fecundity)~treatment*flav_Conc,data=dat2)
fit4<-glmmTMB(Standardize(GM_Fecundity)~treatment+flav_Conc,data=dat2)
anova(fit3,fit4) #Yes, very much so.
summary(fit3)

#Could just leave it because could detect no flavonoids in the roots. ...



```

#Fecundity in the maple treatment.

```{r}

fit<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family),data=datM[!is.na(datM$ChlorA),])
fit01<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family)+(1|gh_bench),data=datM[!is.na(datM$ChlorA),])
anova(fit,fit01)#gh bench not importnat
fit02<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival+(1|Family)+(1|Col_Field),data=datM[!is.na(datM$ChlorA),])
anova(fit,fit02) #Field location not important
fit03<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass)+Standardize(GM_TotalLeaf_Area)+Maple_Survival,data=datM[!is.na(datM$ChlorA),])
anova(fit,fit03) #Family  not important


#Is there an effect of Survival?
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass)+as.factor(Maple_Survival),data=datM[!is.na(datM$Maple_Survival),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_Survival),])
anova(fit2,fit3) #No, Maple Survival is not important. 


#Is there an effect of GM Size in first year?
fit2<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(GM_TotalLeaf_Area)+Standardize(MapleFinalMass),data=datM[!is.na(datM$GM_TotalLeaf_Area),])
fit3<-glmmTMB(GM_Fecundity~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass),data=datM[!is.na(datM$GM_TotalLeaf_Area),])
anova(fit2,fit3) #No, Size in the first year is not important. 

#Is there an effect of maple size in the first year? 
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Maple_TotalLeafArea_End)+Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_TotalLeafArea_End),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~Standardize(MapleFinalMass),data=datM[!is.na(datM$Maple_TotalLeafArea_End),])
summary(fit2)
anova(fit2,fit3) #No. 

#IS there an effect of maple size in the second year? 
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(MapleFinalMass),data=datM[!is.na(datM$MapleFinalMass),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~1,data=datM[!is.na(datM$MapleFinalMass),])
summary(fit2)
anova(fit2,fit3) #No there is not 


```

#Survival and fecundity in the gm treatment is found in the "Performance_Intraspecific" file. 









