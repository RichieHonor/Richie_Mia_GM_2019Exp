---
title: "Intraspecific Fitness affect"
author: "Richard Honor"
date: "05/05/2020"
output: html_document
---

#Read in and prep data
```{r}
library(ggplot2)
library(dplyr)
library(car)
library("glmmTMB")


#read in data
rm(list=ls())
dat<-read.csv("DataSynthesis.csv",stringsAsFactors = F)


#remove those with fertilizer treatment, and extra genotypes that are only in the alone treatment. 
dat<-dat[!grepl("i",dat$Sample,fixed=T),]


#Function to standardize data.
Standardize<-function(x,set.sd=F,SD){
  if(set.sd==T){
      standard<-(x-mean(x,na.rm=T))/SD
  }
  else{
     standard<-(x-mean(x,na.rm=T))/sd(x,na.rm=T)
  }
}


dat$Fern<-log(dat$Fern+1)
dat$gluc_Conc<-log(dat$gluc_Conc)
dat$flav_Conc<-log(dat$flav_Conc)
dat$ChlorA<-log(dat$ChlorA)
dat$ThripsDam<-log(dat$ThripsDam+1)
dat$BlackPathDam<-log(dat$BlackPathDam+1)



#Calculating leaf area 
dat$GM_Leaf_Area<-dat$GM_Leaf_Wid*dat$GM_Leaf_Len

#Average Duplicates. 
dat2<-dat %>% select(-X) %>% group_by(Tag) %>%  summarize(gh_col=first(gh_col),gh_bench=first(gh_bench),treatment=first(treatment),GA3=first(GA3),Family=first(Family),Maple_StemHeight_End=mean(Maple_StemHeight_End),Maple_LeafNum_End=mean(Maple_LeafNum_End),maple_leaf_length_0=mean(maple_leaf_length_0),maple_leaves_0=mean(maple_leaves_0),Maple_TotalLeafArea_End=mean(Maple_TotalLeafArea_End),MapleDamage=mean(Maple_Damage_End),Fern=first(Fern),gluc_Conc=mean(gluc_Conc),flav_Conc=mean(flav_Conc),maple_height_0=mean(maple_height_0),ChlorA=mean(ChlorA), GM_TotalLeaf_Area=first(GM_TotalLeaf_Area),ThripsDam=mean(ThripsDam),BlackPathDam=mean(BlackPathDam),WhiteFungDam=mean(WhiteFungDam),comp_number=first(comp_number),GM_Leaf_Area=mean(GM_Leaf_Area),
                                                          GM_StemHeight_Bolt=first(GM_StemHeight_Bolt),
GM_Leaf_Number_Bolt=first(GM_Leaf_Number_Bolt),
Larg_Leaf_Len_Bolt=first(Larg_Leaf_Len_Bolt),
Larg_Leaf_Wid_Bolt=first(Larg_Leaf_Wid_Bolt),
Row_Field=first(Row_Field),
Col_Field=first(Col_Field),
Maple_Died=first(Maple_Died),
Maple_TotalLeafArea_End=first(Maple_TotalLeafArea_End),
GM_Fecundity=first(GM_Fecundity),
MapleFinalMass=first(MapleFinalMass))


#Creating Survival Data.1 = survived, 0= dead.
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt=="Dead"]<-0
dat2$Bolt_Survival[dat2$GM_StemHeight_Bolt!="Dead"]<-1


#Creating Maple Survival Data.1 = survived, 0= dead.
dat2$Maple_Died<-as.character(dat2$Maple_Died)
dat2$Maple_Survival[dat2$Maple_Died!="Y"]<-1
dat2$Maple_Survival[dat2$Maple_Died=="Y"]<-0
dat2<-dat2 %>% select(-Maple_Died)

dat2[which(dat2$GM_Leaf_Number_Bolt=="Dead"&!is.na(dat2$GM_Fecundity)),]$Bolt_Survival<-1


#Converting white fungal damage to logistic. 
dat2$WhiteFungLogis<-NA
dat2$WhiteFungLogis[dat2$WhiteFungDam>0]<-"Yes"
dat2$WhiteFungLogis[dat2$WhiteFungDam==0]<-"No"


dat2<-dat2[!grepl("maple",dat2$Tag,fixed = T),]

dat2<-dat2[dat2$treatment=="gm",]


#All of these genotypes died (15 Genotypes).(We are simply missing a final measurement for e|JBCHY1-1-50|Q|240) That is only 3% Mortality. 
dead<-dat2[is.na(dat2$GM_TotalLeaf_Area),]

#Removing those with dead competitors from the garlic mustard treatment. ("e|JBCHY1-1-50|Q|240") did not die, we are simply missing the final measurement for it.

dead_competitors<-dead %>% filter(treatment=="gm",Tag!="e|JBCHY1-1-50|Q|240") %>% select(comp_number)

#Removing those with dead competitors from the analysis. 
dat2<-dat2 %>% filter(!comp_number %in% dead_competitors$comp_number)
dat<-dat %>% filter(!comp_number %in% dead_competitors$comp_number)
dat2<-dat2[dat2$comp_number!=79,]
dat2<-dat2[dat2$comp_number!=37,]
dat2<-dat2[dat2$comp_number!=59,]
```


#PCA of GM SIZE in the second year. 
```{r}
#Removing dead individuals with zeros. 
dat2$GM_StemHeight_Bolt[which(dat2$GM_StemHeight_Bolt=="Dead")]<-0
dat2$GM_Leaf_Number_Bolt[which(dat2$GM_Leaf_Number_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Len_Bolt[which(dat2$Larg_Leaf_Len_Bolt=="Dead")]<-0
dat2$Larg_Leaf_Wid_Bolt[which(dat2$Larg_Leaf_Wid_Bolt=="Dead")]<-0

#Making data numeric
dat2$GM_StemHeight_Bolt<-as.numeric(dat2$GM_StemHeight_Bolt)
dat2$GM_Leaf_Number_Bolt<-as.numeric(dat2$GM_Leaf_Number_Bolt)
dat2$Larg_Leaf_Len_Bolt<-as.numeric(dat2$Larg_Leaf_Len_Bolt)
dat2$Larg_Leaf_Wid_Bolt<-as.numeric(dat2$Larg_Leaf_Wid_Bolt)


pca<-prcomp(~GM_StemHeight_Bolt+GM_Leaf_Number_Bolt+Larg_Leaf_Len_Bolt+Larg_Leaf_Wid_Bolt,data=dat2,scale.=T,na.action=na.omit)

prediction<-as.data.frame(predict(pca))

df<-tibble::rownames_to_column(prediction, "rownumber")

dat2[df$rownumber,"PC1BoltSize"]<-df$PC1

hist(dat2$PC1BoltSize) #The data is very zero inflated because of the mortality. This isnt great but what can you do. 
```


```{r}
table(dat2$comp_number)
#Generating collumn for the competitor family.
count=0
dat2$Family<-as.character(dat2$Family)
for(i in 1:length(dat2$comp_number)){
  temp<-dat2[dat2$comp_number==dat2$comp_number[i]&dat2$Tag!=dat2$Tag[i],c("Family","GM_TotalLeaf_Area","gluc_Conc","PC1BoltSize","Bolt_Survival")]#Selects the competitors data
count=count+1

  if(length(temp$Family[!is.na(temp$Family)])==0){ #if there are no values...Makes the values NA
   dat2$competitor[i]<-NA
  }
else{ #Assign the competitor data to the data frame. 
    dat2$competitor[i]<-temp$Family[!is.na(temp$Family)] 
}

  if(length(temp$GM_TotalLeaf_Area[!is.na(temp$GM_TotalLeaf_Area)])==0){
   dat2$comp_Size[i]<-NA
  }
else{
   dat2$comp_Size[i]<-temp$GM_TotalLeaf_Area[!is.na(temp$GM_TotalLeaf_Area)]  
}

  if(length(temp$gluc_Conc[!is.na(temp$gluc_Conc)])==0){
   dat2$comp_Gluc[i]<-NA
 }
  else {
  dat2$comp_Gluc[i]<-temp$gluc_Conc[!is.na(temp$gluc_Conc)]
  }

  if(length(temp$PC1BoltSize[!is.na(temp$PC1BoltSize)])==0){
   dat2$CompSizeBolt[i]<-NA
 }
  else {
  dat2$CompSizeBolt[i]<-temp$PC1BoltSize[!is.na(temp$PC1BoltSize)]
  }

  if(length(temp$Bolt_Survival[!is.na(temp$Bolt_Survival)])==0){
   dat2$Comp_Survival[i]<-NA
 }
  else {
  dat2$Comp_Survival[i]<-temp$Bolt_Survival[!is.na(temp$Bolt_Survival)]
    }
}
dat2
dat2$GM_Leaf_Number_Bolt
```
#New assessment performance in intraspecific.
```{r}
#Modelling random effects 
fit<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Standardize(Fern)+Standardize(BlackPathDam)*WhiteFungLogis*Standardize(ThripsDam)+competitor+comp_Size+(1|Family)+(1|gh_bench),data=dat2)
summary(fit)
fit2<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Standardize(Fern)+Standardize(BlackPathDam)*WhiteFungLogis*Standardize(ThripsDam)+competitor+comp_Size+(1|gh_bench),data=dat2)
summary(fit)
fit3<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Standardize(Fern)+Standardize(BlackPathDam)*WhiteFungLogis*Standardize(ThripsDam)+competitor+comp_Size+(1|Family),data=dat2)
summary(fit)

#Is bench important?
anova(fit,fit3) #Yes, very. 

#Is family important? 
anova(fit,fit2) #Yes it is. 


#Modelling fixed effects 

dat2$BlackPathDam<-Standardize(dat2$BlackPathDam)
dat2$ThripsDam<-Standardize(dat2$ThripsDam)
dat2$Fern<-Standardize(dat2$Fern)


fit0.1<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+competitor+comp_Size+(1|Family)+(1|gh_bench),data=dat2)

fit2<-update(fit0.1,~.-ThripsDam:BlackPathDam:WhiteFungLogis)
anova(fit0.1,fit2) #Yes... a significant three way interaction.

#Is fern importnat? 
fit1<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+competitor+comp_Size+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$Fern),])
fit2<-glmmTMB(Standardize(GM_TotalLeaf_Area)~BlackPathDam*WhiteFungLogis*ThripsDam+competitor+comp_Size+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$Fern),])
anova(fit1,fit2)#Yes, extremely. 
summary(fit1)

#Is competitor family important? 
fit1<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+competitor+comp_Size+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$Fern),])
fit2<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+comp_Size+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$Fern),])
anova(fit1,fit2) #No it is not. 

#Is the three way interaction significant? 

fit3<-update(fit2,~.-ThripsDam:BlackPathDam:WhiteFungLogis)
anova(fit3,fit2) #Yes... still significant. 


#Is competitor size important?

fit1<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+comp_Size+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$comp_Size),])
fit2<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$comp_Size),])
anova(fit1,fit2) #Yes, extremely

#Best model is. 
fit1<-glmmTMB(Standardize(GM_TotalLeaf_Area)~Fern+BlackPathDam*WhiteFungLogis*ThripsDam+Standardize(comp_Size)+(1|Family)+(1|gh_bench),data=dat2[!is.na(dat2$comp_Size),])
summary(fit1)
```



#GM survival
```{r}
dat2$Comp_Survival<-as.factor(dat2$Comp_Survival)



fit<-glmmTMB(Bolt_Survival~Fern+BlackPathDam+WhiteFungLogis+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")

fit1<-glmmTMB(Bolt_Survival~Fern+WhiteFungLogis+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),],family="binomial")
anova(fit,fit1) #Model wouldnt fit... dont know 

fit1<-glmmTMB(Bolt_Survival~Fern+WhiteFungLogis+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")
fit2<-glmmTMB(Bolt_Survival~Fern+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),],family="binomial")
anova(fit2,fit1) #Model wouldnt fit... dont know 

#IS Fern important?
fit2<-glmmTMB(Bolt_Survival~Fern+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),],family="binomial")
fit3<-glmmTMB(Bolt_Survival~competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),],family="binomial")

anova(fit2,fit3) #Model wouldnt fit, dont know



#Is competitor important? 
fit4<-glmmTMB(Bolt_Survival~competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$competitor),],family="binomial")
fit5<-glmmTMB(Bolt_Survival~comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$competitor),],family="binomial")
anova(fit4,fit5) #Model wouldnt fit dont know.

#Is competitor size important? 
fit4<-glmmTMB(Bolt_Survival~competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$comp_Size),],family="binomial")
fit5<-glmmTMB(Bolt_Survival~competitor+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$comp_Size),],family="binomial")
anova(fit4,fit5) #CModel wouldnt fit dont know 

```




#This is where the model starts to converge for bolt survival in the intraspecific treatment. 
```{r}
#IS comp survival important? 
fit5<-glmmTMB(Bolt_Survival~competitor+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),],family="binomial")
fit6<-glmmTMB(Bolt_Survival~competitor+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),],family="binomial")
anova(fit5,fit6) #Yes, competitor survival is incredibly important to determien the survival of the focal plant. 

fit5<-glmmTMB(Bolt_Survival~Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),],family="binomial")
summary(fit5)

table(dat2$Bolt_Survival,dat2$Comp_Survival)
102/(102+11)*100
11/(102+11)*100
11/(42+11)*100
42/(42+11)*100


#Is competitor important? 
fit5<-glmmTMB(Bolt_Survival~competitor+Comp_Survival+(1|Family),family="binomial",data=dat2)
fit6<-glmmTMB(Bolt_Survival~Comp_Survival+(1|Family),family="binomial",data=dat2)
anova(fit5,fit6) #No competitor is not important, but it is on the edge of significance. (0.053)

#Is competitor size important? 

fit6<-glmmTMB(Bolt_Survival~Comp_Survival+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])

fit7<-glmmTMB(Bolt_Survival~Comp_Survival+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
anova(fit6,fit7) #No competitor size is not important. 

#Is familly importnat as a random effect? 
fit7<-glmmTMB(Bolt_Survival~Comp_Survival+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
fit6<-glmmTMB(Bolt_Survival~Comp_Survival,family="binomial",data=dat2[!is.na(dat2$comp_Size),])
anova(fit6,fit7) #No, but it is close. 
summary(fit7)


#Best model
fit5<-glmmTMB(Bolt_Survival~competitor+Comp_Survival+(1|Family),family="binomial",data=dat2)
summary(fit5)


#Is familly importnat as a random effect? 
fit7<-glmmTMB(Bolt_Survival~Comp_Survival+competitor,family="binomial",data=dat2[!is.na(dat2$comp_Size),])
fit6<-glmmTMB(Bolt_Survival~Comp_Survival,family="binomial",data=dat2[!is.na(dat2$comp_Size),])
anova(fit6,fit7) #No, but it is close. 
summary(fit7)



```


Do analysis on fecundity and add in fern and gluc conc and flav conc to previous analyses. 

#Survival data redone. 
```{r}
#Is familly importnat as a random effect? #Comp size, gh_bench would not fit. 
fit<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam*ThripsDam*WhiteFungLogis+(1|Family),family="binomial",data=dat2)

fit2<-update(fit,~.-ThripsDam:BlackPathDam:WhiteFungLogis)
anova(fit,fit2) #Not a significant three way interaction.

fit3<-update(fit2,~.-BlackPathDam:WhiteFungLogis)
anova(fit3,fit2) #There is not a significant two way interaction.

fit4<-update(fit3,~.-BlackPathDam:ThripsDam)
anova(fit4,fit3)
#There is no significant interaction between black path dam and thrips dam

fit5<-update(fit4,~.-WhiteFungLogis:ThripsDam)
anova(fit5,fit4) #There is not significant white path and thripsdamage interaction.

summary(fit5)

#White fung dam? 
fit<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam+ThripsDam+WhiteFungLogis+(1|Family),family="binomial",data=dat2[!is.na(dat2$WhiteFungLogis),])
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam+ThripsDam+(1|Family),family="binomial",data=dat2[!is.na(dat2$WhiteFungLogis),])
anova(fit,fit2) #no

#Thrips  dam? 
fit<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam+ThripsDam+(1|Family),family="binomial",data=dat2[!is.na(dat2$ThripsDam),])
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam+(1|Family),family="binomial",data=dat2[!is.na(dat2$ThripsDam),])
anova(fit,fit2) #no


#Black PAth dam? 
fit<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+BlackPathDam+(1|Family),family="binomial",data=dat2[!is.na(dat2$BlackPathDam),])
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+(1|Family),family="binomial",data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit,fit2) #no

#adding in random effects/assessing significance? (no fit gh_bench, Row Field, Col Field. )
fit1<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+(1|Family)+(1|Col_Field),family="binomial",data=dat2)
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+(1|Family),family="binomial",data=dat2)
anova(fit1,fit2) #No fit. 

#Assessing comp size
fit1<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
anova(fit1,fit2) #Comp size is significant here. 

#Assessing competitor?
fit1<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
fit2<-glmmTMB(Bolt_Survival~Comp_Survival+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$comp_Size),])
anova(fit1,fit2) #Competitor is also significant. 

#Assessing Survival.

fit1<-glmmTMB(Bolt_Survival~Comp_Survival+competitor+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$Comp_Survival),])
fit2<-glmmTMB(Bolt_Survival~competitor+Standardize(comp_Size)+(1|Family),family="binomial",data=dat2[!is.na(dat2$Comp_Survival),])
anova(fit1,fit2) #Competitor is highly significant. 

summary(fit1)

```

#Redoing gm fecundity. 
```{r}
fit<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+BlackPathDam+WhiteFungLogis+ThripsDam+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),])

```


#GM Fecundity
```{r}
dat2$Comp_Survival<-as.factor(dat2$Comp_Survival)

#Full model. 


#IS Family Important
fit<-glmmTMB(GM_Fecundity~Fern+BlackPathDam+WhiteFungLogis+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),])
fit1<-glmmTMB(GM_Fecundity~Fern+BlackPathDam+WhiteFungLogis+competitor+Standardize(comp_Size)+Comp_Survival,data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit,fit1) #Family is important in the GM treatment for fecundity. 

#IS black path dam important?
fit<-glmmTMB(GM_Fecundity~Fern+BlackPathDam+WhiteFungLogis+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),])
fit1<-glmmTMB(GM_Fecundity~Fern+WhiteFungLogis+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$BlackPathDam),])
anova(fit,fit1) #No


#Is white fung dam?
fit1<-glmmTMB(GM_Fecundity~Fern+WhiteFungLogis+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),])
fit2<-glmmTMB(GM_Fecundity~Fern+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$WhiteFungLogis),])
anova(fit2,fit1) #No

#IS Fern important?
fit2<-glmmTMB(GM_Fecundity~Fern+competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),])
fit3<-glmmTMB(GM_Fecundity~competitor+comp_Size+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),])
anova(fit2,fit3) #Yes Fern influenced fecundity. 

#Is competitor important? 
fit4<-glmmTMB(GM_Fecundity~Fern+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$competitor),])
fit5<-glmmTMB(GM_Fecundity~Fern+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$competitor),])
anova(fit4,fit5) #Yes the competitor does influence fecundity.


#Is competitor size (First year) important? 
fit4<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$comp_Size),])
fit5<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$comp_Size),])
anova(fit4,fit5) #Yes competitor size in the first year is significant (on the edge)
summary(fit4)

#IS comp survival important? 
fit5<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),])
fit6<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),])
anova(fit5,fit6) #Yes, competitor survival is incredibly important to determien the survival of the focal plant. 
summary(fit5)

#Is comp size important (Second year)? 
fit5<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+CompSizeBolt+(1|Family),data=dat2[!is.na(dat2$CompSizeBolt),])
fit6<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$CompSizeBolt),])
anova(fit5,fit6) #No, competitor size in second year is not important. 
summary(fit5)
# Reassessing IS comp survival important? 
fit5<-glmmTMB(GM_Fecundity~competitor+Standardize(Fern)+Comp_Survival+CompSizeBolt+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),])
fit6<-glmmTMB(GM_Fecundity~competitor+Standardize(Fern)+CompSizeBolt+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$Comp_Survival),])
anova(fit5,fit6) #Yes competitor survival is still important even with bolt size in the analysis.  

# Reassessing IS comp size important? 
fit5<-glmmTMB(Standardize(GM_Fecundity)~competitor+Standardize(CompSizeBolt)+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$CompSizeBolt),])
fit6<-glmmTMB(Standardize(GM_Fecundity)~competitor+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$CompSizeBolt),])
anova(fit5,fit6) #Yes, without survival competitor is still important, but not with it. I will not include it as significant because it is likely largely just driven by the zeros in the data. 
summary(fit5)

summary(fit5) #
#IF your competitor survives, you are more likely to as well. This is like kin selection..

#Reassessing Fern
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),])
fit3<-glmmTMB(Standardize(GM_Fecundity)~competitor+Comp_Survival+Standardize(comp_Size)+(1|Family),data=dat2[!is.na(dat2$Fern),])
anova(fit2,fit3) #Fern is significant. 

#Best model is thus: 
fit2<-glmmTMB(Standardize(GM_Fecundity)~Standardize(Fern)+competitor+Standardize(comp_Size)+Comp_Survival+(1|Family),data=dat2[!is.na(dat2$Fern),])
summary(fit2)

```


#Extra stuff to calculate Standardized SD's. 

plot(residuals(fit))
qqnorm(residuals(fit))
plot(residuals(fit,type="pearson"))
plot(residuals(fit,type="pearson")~fitted(fit))


#Coefficients for results
fit<-glmmTMB(Standardize(GM_TotalLeaf_Area,set.sd=T,3549.252)~Standardize(comp_Size)+Standardize(ThripsDam)+Standardize(BlackPathDam)+(1|Family),data=dat2[!is.na(dat2$comp_Size),])
summary(fit)

#-0.31502 effect on SD per SD unit. (GM on GM)

GMonGM<-Standardize(dat2$comp_Size)
GMonGM
#write.csv(GMonGM,"GM_SD_OnGM.csv")



